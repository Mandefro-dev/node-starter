import express, { Application, Request, Response, NextFunction } from 'express';
import cors from "cors"
import dotenv from "dotenv"
import morgan from "morgan"
import helmet from "helmet"
import routes from "./routes"
import { errorHandler } from './middleware/error.middleware';

<% if(dbType==="MongoDB"){ %>
    import mongoose from "mongoose";
<%} else if (dbType==="PostgreSQL"){%>
    import {Sequelize} from "sequelize"
    <% } %>

    dotenv.config()

const PORT=process.env.PORT||3000


const app:Application =express()
app.use(helmet());
app.use(cors())
app.use(express.json())
app.use(morgan('dev'));

<% if (dbType === 'MongoDB') { %>
mongoose.connect(process.env.DB_URI as string)
  .then(() => console.log(' Connected to MongoDB'))
  .catch(err => console.error(' Mongo Error:', err));
<% } else if (dbType === 'PostgreSQL') { %>
// Sequelize init code 
console.log(' Initializing PostgreSQL connection...');
<% } else { %>
console.log(' No database selected.');
<% } %>

app.use('/api/v1', routes);

app.get('/health', (req: Request, res: Response) => {
  res.status(200).json({ status: 'UP', timestamp: new Date().toISOString() });
});
app.get("/",(req,res)=>{

    res.status(200).json({
        message:"Welcome to <%= projectName %>",
        environment:process.env.NODE_ENV
    })
})
app.use(errorHandler)

app.listen(PORT,()=>{
    console.log(`server Connected to port ${PORT}`)
})